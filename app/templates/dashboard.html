{% extends "base.html" %}
{% block body %}
<div class="card">
  <h1>Dashboard</h1>
  <p>Autenticado ✅</p>
  <textarea id="text" placeholder="Texto a analizar">Ejemplo rápido</textarea>
  <button id="run">Generar PDF</button>
  <div id="out"></div>
  <button id="logout" class="ghost">Salir</button>
</div>
<script>
  const token = localStorage.getItem('token');
  if(!token){ location.href = '/'; }
  document.querySelector('#logout').onclick = () => { localStorage.removeItem('token'); location.href = '/'; }
  document.querySelector('#run').onclick = async () => {
    const text = document.querySelector('#text').value;
    const res = await fetch('/analysis/run?text='+encodeURIComponent(text), {
      method:'POST', headers:{'Authorization': 'Bearer ' + token}
    });
    const data = await res.json();
    const out = document.querySelector('#out');
    out.innerHTML = '';
    const a = document.createElement('a');
    a.href = '/' + data.pdf_path; a.textContent = 'Descargar reporte';
    out.appendChild(a);
  }
</script>
{% endblock %}
